<html>
  <head>
    <link rel="stylesheet" href="../../css/spectre.min.css">
  </head>
  <body>

    <p>The METAR/TAF information is obtained from <a href="https://account.avwx.rest/">AVWX</a>. You need an account and generate an API token. The free "Hobby" plan is sufficient, but please consider supporting the AVWX project.</p>
    <p>
      <label class="form-label" for="AVWXtoken">AVWX API Token:</label>
      <input class="form-input" type="text" id="AVWXtoken" placeholder="Your personal AVWX API Token" />
    </p>
    <p>
      <button id="upload" class="btn btn-primary">Upload</button>
    </p>

    <script src="../../core/lib/customize.js"></script>
    <script>
      var settings = {};

      function onInit(device) {
        // read in existing settings to preserve them during an update
        try {
          Util.readStorageJSON('avwx.json', currentSettings => {
            if (currentSettings) {
              settings = currentSettings;
              if ('AVWXtoken' in settings) {
                document.getElementById('AVWXtoken').value = settings.AVWXtoken;
              }
            }
          });
        } catch (e) {
          console.log("Failed to read existing settings: "+e);
        }
      }

      document.getElementById("upload").addEventListener("click", function() {
        settings.AVWXtoken = document.getElementById('AVWXtoken').value;
        sendCustomizedApp({
          storage:[
            { name: "avwx.json", content: JSON.stringify(settings) },
          ]
        });
      });
    </script>

  </body>
</html>
